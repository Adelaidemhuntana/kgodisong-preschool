<!DOCTYPE html>
<html lang="en">


<head>
   <meta charset="utf-8">
   <title>Immunization Booking | Kgodisong Health Hub</title>
   <meta content="width=device-width, initial-scale=1.0" name="viewport">


   <!-- Bootstrap & CSS -->
   <link href="css/bootstrap.min.css" rel="stylesheet">
   <link href="css/style.css" rel="stylesheet">
</head>


<body>


<script>
   // Redirect if not logged in
   fetch("/api/check-session")
       .then(res => res.json())
       .then(data => {
           if (!data.logged_in) {
               window.location.href = "/login";
           }
       });
</script>


<div class="container py-5">
   <h1 class="page-title text-center mb-4"><a href="hub-dashboard.html"> Vaccination & Immunization Booking</a></h1>
   <p class="text-center mb-5">Book your child's immunization or health check</p>


   <div class="row justify-content-center">
       <div class="col-lg-6">
           <div class="card p-4 shadow-lg">
               <form id="vaccineForm" method="POST" action="/api/vaccine-booking">
                   <div class="mb-3">
                       <label class="form-label">Child Name</label>
                       <input name="child_name" type="text" class="form-control" placeholder="Enter childâ€™s full name" required>
                   </div>


                   <div class="mb-3">
                       <label class="form-label">Grade / Class</label>
                       <input name="grade" type="text" class="form-control" placeholder="e.g. Grade R, Mickey Class" required>
                   </div>


                   <div class="mb-3">
                       <label class="form-label">Select Vaccine Type</label>
                       <select name="vaccine_type" class="form-control" required>
                           <option value="">-- Choose vaccine --</option>
                           <option>Measles</option>
                           <option>Polio</option>
                           <option>BCG</option>
                           <option>Immunization</option>
                           <option>Chickenpox</option>
                           <option>General Health Check</option>
                       </select>
                   </div>


                   <div class="mb-3">
                       <label class="form-label">Preferred Date</label>
                       <input name="date" type="date" class="form-control" required>
                   </div>


                   <div class="d-grid">
                       <button class="btn btn-pink btn-lg" type="submit">Book Appointment</button>
                   </div>
               </form>


               <p id="successMessage" class="text-center text-success mt-4" style="display:none;">
                   âœ” Booking submitted! The school will confirm soon.
               </p>
           </div>
       </div>
   </div>
</div>


<script>
   // Submit form via fetch to show success without reload
document.getElementById('vaccineForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const form = e.target;
    const data = new FormData(form);

    fetch("/api/vaccine-booking", {
        method: "POST",
        body: data
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {

            const msg = document.getElementById('successMessage');

            // AI Clinic Illusion Message
            msg.innerHTML = `
                <div class="p-3 border rounded shadow-sm bg-light">
                    <strong class="text-success">âœ” Booking Confirmed</strong><br>
                    Reference: <strong>${data.reference}</strong><br><br>

                    <small class="text-muted">
                        ðŸ©º <strong>AI Health Dispatcher</strong> has securely transmitted<br>
                        this immunization request to <strong>Medi-clinic</strong> for review.<br>
                        You will receive a follow-up once the clinic confirms.
                    </small>
                </div>
            `;

            // Show animated message
            msg.style.display = "block";
            msg.classList.add("show");

            form.reset();
        }
    })
    .catch(err => console.error(err));
});

</script>


</body>
</html>
