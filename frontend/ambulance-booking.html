<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/ambulance.css">
    <title>Ambulance Booking - Kgodisong Preschool</title>

    <style>
        #successBox {
            display: none;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            margin-top: 15px;
        }
        #successBox.show {
            opacity: 1;
        }
        #successBox div {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="header">
    ðŸš‘ Emergency Ambulance Request
</div>

<div class="container">
    <div class="card">
        <form id="ambulanceForm">
            <label>Child's Full Name</label>
            <input type="text" id="childName" name="child_name" placeholder="Enter child's name" required>

            <label>Class / Grade</label>
            <input type="text" id="className" name="class_name" placeholder="E.g. Grade R, Baby Class" required>

            <label>Type of Emergency</label>
            <select id="emergencyType" name="emergency_type" required>
                <option value="">-- select emergency --</option>
                <option>High Fever</option>
                <option>Breathing Problems</option>
                <option>Seizures</option>
                <option>Severe Injury</option>
                <option>Allergic Reaction</option>
                <option>Other</option>
            </select>

            <label>Describe What Happened</label>
            <textarea id="description" name="description" placeholder="Give a short explanation..." required></textarea>

            <button class="btn" type="submit">Request Ambulance</button>
        </form>

        <div id="successBox" class="success"></div>
    </div>

    <div class="footer">
        Kgodisong Preschool
    </div>
</div>

<script>
    const form = document.getElementById('ambulanceForm');
    const box = document.getElementById('successBox');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(form);

        fetch('/api/ambulance-booking', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                const childName = formData.get('child_name');
                const className = formData.get('class_name');
                const emergencyType = formData.get('emergency_type');

                box.innerHTML = `
                    <div class="p-3 border rounded shadow-sm bg-light">
                        <strong class="text-success">ðŸš‘ Ambulance Requested!</strong><br>
                        Reference: <strong>${data.reference}</strong><br>
                        Child: <strong>${childName}</strong><br>
                        Class: <strong>${className}</strong><br>
                        Emergency: <strong>${emergencyType}</strong><br><br>
                        <small class="text-muted">
                            ðŸ©º <strong>AI Emergency Dispatcher</strong> has notified the nearest clinic/hospital.<br>
                            You will receive updates shortly.
                        </small>
                    </div>
                `;
                box.style.display = 'block';
                box.classList.add('show');

                form.reset();
            }
        })
        .catch(err => console.error(err));
    });
</script>

</body>
</html>
